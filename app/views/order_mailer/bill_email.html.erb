<h1 style="margin-left: 47%;">Billing Page</h1>

<p><strong>Customer Email:</strong> <%= @order.customer.email %></p>
<p><strong>Date:</strong> <%= @order.created_at.strftime("%d %b %Y") %></p>

<hr>
<h3>Bill Section</h3>
<hr>

<table cellpadding="6" cellspacing="0" border="1" width="100%">
  <thead>
    <tr>
      <th>Product ID</th>
      <th>Unit Price</th>
      <th>Quantity</th>
      <th>Purchase Price</th>
      <th>Tax % for Item</th>
      <th>Tax Payable for Item</th>
      <th>Total Price of the Item</th>
    </tr>
  </thead>

  <tbody>
    <% @order.order_items.each do |item| %>
      <% purchase_price = item.unit_price * item.quantity %>
      <tr>
        <td><%= item.product_code %></td>
        <td><%= item.unit_price %></td>
        <td><%= item.quantity %></td>
        <td><%= purchase_price %></td>
        <td><%= item.tax_percentage %>%</td>
        <td><%= item.tax_amount %></td>
        <td><%= item.line_total %></td>
      </tr>
    <% end %>
  </tbody>
</table>

<hr>

<hr>

<div style="width: 40%; margin-left: auto;">

  <p>
    <strong>Total price without tax:</strong>
    <span style="float: right;"><%= @order.subtotal_amount %></span>
  </p>

  <p>
    <strong>Total tax payable:</strong>
    <span style="float: right;"><%= @order.total_tax %></span>
  </p>

  <p>
    <strong>Net price of purchase item:</strong>
    <span style="float: right;"><%= @order.subtotal_amount + @order.total_tax %></span>
  </p>

  <p>
    <strong>Rounded down value of purchased items net price:</strong>
    <span style="float: right;"><%= @order.grand_total %></span>
  </p>

  <p>
    <strong>Cash paid by customer:</strong>
    <span style="float: right;"><%= @order.cash_paid %></span>
  </p>

  <p>
    <strong>Balance payable to customer:</strong>
    <span style="float: right;"><%= @order.cash_paid - @order.grand_total %></span>
  </p>
</div>

<hr>

<div style="width: 40%; margin-left: auto;">
  <h3>Balance Denomination Breakdown</h3>
  <ul>
    <% @order.order_change_breakdowns.order(denomination_value: :desc).each do |c| %>
      <li><%= c.denomination_value %> Ã— <%= c.count %></li>
    <% end %>
  </ul>

</div>
